# 20 即时调试 & 内存注入
* 编写一个内存注入工具
要求：
	1. 软件界面能显示当前系统中所有进程ID以及进程名称
	2. 软件界面中能显示指定进程的模块句柄以及模块完整路径
	3. 可以给指定进程注入模块


在易语言控件中的超级列表框的下标是从第0列开始的，但是数组记得下表标又是从1开始的，有区别要记住。

我们发现我们注入成功后，我们写的模块遍历工具，没法读取和显示出来被注入的dll（这个dll里面引用模块，模块会先被执行）,OD里也无法显示，其实原因很简单，就是这一块dll的PE文件被贴入了内存里。但是这个dll为什么会跑起来？？？原理就是开了个远程线程！

下断点WriteProcessMemory，就能找到内存里的PE文件，可用二进制编辑文件粘贴出来

* 即时调试JIT技巧
按下面设置就可以让OD接管程序错误调试
```
在32位操作系统:
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug\Debugger
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\DbgManagedDebugger

在64位操作系统: 
(这个是调试托管程序集的，还没学先不看) HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\DbgManagedDebugger

(现在先学的这个)
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\AeDebug\Debugger
```

或者：OD--》选项--》实时调试设置--》设置OllyICE为实时调试器

还有在用上面写的工具注入dll的时候，如果用OD调试呢，如下图设置：勾选中断于新线程
![[Pasted image 20240213205550.png]]
如果是勾选中断于新模块，那每次都会断在一个新模dll块还没开始执行的起始位置

用A进程启动B进程`运行 (取运行目录 () ＋ “\我是被注入的程序.exe”, 假, )`
怎么在被启动的B进程时候中被OD接管调试B进程？？？
可以把B进程的OEP改成int 3报错，触发实时调试器