/*! For license information please see c__Review.edaae10d.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1397],{3918:function(e,t,r){"use strict";var n=r(0);t.a=function(e,t){Object(n.useEffect)((function(){if(e){var r=function(e){return e.preventDefault(),t&&(e.returnValue=t),t};return window.addEventListener("beforeunload",r),function(){return window.removeEventListener("beforeunload",r)}}}),[t,e])}},3985:function(e,t,r){"use strict";r(3233);var n=r(2778);r(3226);t.a=n.a},4130:function(e,t,r){"use strict";var n=r(0),a=r.n(n),o=r(4),i=r.n(o);function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function u(e){var t=e.content,r=e.disableHeaderBr;if(!t)return[];var n=t.trim().split("\n"),o=[],i=function(e){var t=/(https?:\/\/[^\s]+)/g,r=e.split(t);if(!r)return e;var n,o=[],i=c(r);try{for(i.s();!(n=i.n()).done;){var l=n.value;if(t.test(l)){var u=a.a.createElement("a",{href:l,target:"_blank"},l);o.push(u)}else o.push(l)}}catch(e){i.e(e)}finally{i.f()}return a.a.createElement.apply(a.a,["span",null].concat(o))};return 1===n.length?i(t):(r||o.push(a.a.createElement("br",{key:-1})),n.forEach((function(e,t){o.push(a.a.createElement(a.a.Fragment,{key:t},i(e))),n.length-1!==t&&o.push(a.a.createElement("br",{key:"sep-".concat(t)}))})),o)}u.propTypes={content:i.a.string.isRequired},t.a=u},6871:function(e,t,r){"use strict";r.r(t),r.d(t,"useViewModel",(function(){return ir}));r(3226);var n=r(3985),a=r(0),o=r.n(a),i=r(524),c=r(6),l=r.n(c),u=r(4),s=r.n(u),d=r(449),f=r(59),p=r(3847),m=(r(36),r(8)),v=(r(43),r(10)),h=r(48),y=r(3345),b=(r(170),r(70)),w=(r(52),r(12)),g=r(1364),_=r(1492),E=r(1506),S=r(3918);function C(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return N(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var j={formatUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(e)||(e=[e]);var t,r=C(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.user_id||(n.user_id=n.id)}}catch(e){r.e(e)}finally{r.f()}return e}},A=j,O=r(433),x=r(3637),I=r(4130),T=(r(62),r(31)),k=(r(71),r(35)),R=(r(270),r(135)),L=(r(689),r(225)),P=r(400),D=r.n(P),M=r(1512),U=r(1514),F={tip:"ProductCodeSelector-module_tip_St4dm",emptyTip:"ProductCodeSelector-module_emptyTip_lW7-X",img:"ProductCodeSelector-module_img_C8Xr5",loading:"ProductCodeSelector-module_loading_0OSLf",modalDesc:"ProductCodeSelector-module_modalDesc_XRZ9X",modal:"ProductCodeSelector-module_modal_d62HS",productCodeWrapper:"ProductCodeSelector-module_productCodeWrapper_vMvvU",productNameHeader:"ProductCodeSelector-module_productNameHeader_PCscR",productCode:"ProductCodeSelector-module_productCode_C2MU2",notExpandableProdName:"ProductCodeSelector-module_notExpandableProdName_FusC7",checkbox:"ProductCodeSelector-module_checkbox_bePsu",expandTrigger:"ProductCodeSelector-module_expandTrigger_x7Aha"};function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function G(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=W(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==W(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e){return function(e){if(Array.isArray(e))return Q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(){V=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),c=new I(n||[]);return a(i,"_invoke",{value:j(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",h={};function y(){}function b(){}function w(){}var g={};u(g,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(T([])));E&&E!==r&&n.call(E,i)&&(g=E);var S=w.prototype=y.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function r(a,o,i,c){var l=d(e[a],e,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==W(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function j(t,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=A(c,n);if(l){if(l===h)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=d(t,r,n);if("normal"===u.type){if(a=n.done?v:p,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=v,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=d(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,h;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(W(t)+" is not iterable")}return b.prototype=w,a(S,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(N.prototype),u(N.prototype,c,(function(){return this})),t.AsyncIterator=N,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new N(s(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(S),u(S,l,"Generator"),u(S,i,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return c.type="throw",c.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function z(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function Y(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){z(o,n,a,i,c,"next",e)}function c(e){z(o,n,a,i,c,"throw",e)}i(void 0)}))}}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){if(e){if("string"==typeof e)return Q(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(e,t):void 0}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var X=w.a.Search,J=function(e){var t=H(Object(a.useState)([]),2),r=t[0],n=t[1],o=H(Object(a.useState)(e.selectedCodes),2),i=o[0],c=o[1],l=H(Object(a.useState)(!0),2),u=l[0],s=l[1],d=H(Object(a.useState)(!0),2),f=d[0],p=d[1];Object(a.useEffect)((function(){var e=function(){var e=Y(V().mark((function e(){var t;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.next=3,h.a.mine.productCode();case 3:t=e.sent,n(t),s(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var m=Object(a.useCallback)(D()(function(){var e=Y(V().mark((function e(t){var r;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!1),s(!0),e.next=4,h.a.mine.productCode({query:t||window.appData.me.work_id||""});case 4:r=e.sent,n(r),s(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),800),[]);return{state:{productCodes:r,selectedCodes:i,codeLoading:u,isInitialLoad:f},onAddProductCode:function(){e.onAddProductCode(i)},handleSelectCode:function(e,t){var r,n;!!i.find((function(e){return e.productCode===t.data.productCode}))?(r=t,n=i.filter((function(e){return e.productCode!==r.data.productCode})),c(n)):function(e){if(!i.find((function(t){return t.productCode===e.data.productCode}))){var t=e.data.participantList.find((function(e){return"PRODUCT_PD_OWNER"===e.roleType}))||{},r={productName:e.data.productName,productCode:e.data.productCode,pdOwner:t.userName||""};c([].concat(B(i),[r]))}}(t)},handleChangeQuery:function(e){m(e.target.value)}}},Z=function(e){var t=e.visible,r=J(e),n=r.state,a=n.selectedCodes,i=n.codeLoading,c=n.productCodes,u=n.isInitialLoad,s=a.length>0,d=o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{onClick:e.onCancel},__("取消")),o.a.createElement(m.a,{type:"primary",disabled:!s,onClick:r.onAddProductCode},__("确定"))),f=[{title:o.a.createElement("span",{className:F.productNameHeader},__("产品名称")),dataIndex:["data","productName"],ellipsis:!0,width:272,render:function(e,t){var r=t.data.productCode,n=!!a.find((function(e){return e.productCode===r}));return o.a.createElement("span",{className:l()(G({},F.notExpandableProdName,!(t.children&&t.children.length>0)))},o.a.createElement(L.a,{checked:n,className:F.checkbox}),o.a.createElement("a",{target:"_blank",href:"https://pd.alipay.com/#/product/main?productCode=".concat(t.data.productCode),title:e,onClick:function(e){return e.preventDefault()}},e))}},{title:o.a.createElement("span",{className:F.productCode},__("产品码")),dataIndex:["data","productCode"],width:240,render:function(e){return o.a.createElement("span",{className:F.productCode},e)}},{title:__("产品负责人"),dataIndex:["data","participantList"],render:function(e){var t=e.find((function(e){return"PRODUCT_PD_OWNER"===e.roleType}));return t&&t.userName?o.a.createElement("span",null,t.userName):o.a.createElement("span",null,__("暂无"))}}];return o.a.createElement(T.a,{className:F.modal,title:__("可关联的产品码"),visible:t,footer:d,bodyStyle:{height:445,padding:0,marginBottom:"12px",borderBottom:"1px solid #e8e8e8"},width:666,onCancel:e.onCancel},o.a.createElement("p",{className:l()(F.tip,F.modalDesc)},o.a.createElement("span",null,__("请选择要关联的产品码，或去 {productCode} 申请",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))})),o.a.createElement(b.a,{title:__("产品码是蚂蚁产品委员会发起的对支付宝产品资产进行盘点和梳理的唯一标识")},o.a.createElement(E.default,null))),o.a.createElement("p",{className:F.tip},o.a.createElement(X,{onChange:r.handleChangeQuery,onSelectNone:r.handleChangeQuery,placeholder:__("搜索产品名称、产品码、产品负责人...")})),o.a.createElement("div",{className:F.productCodeWrapper},i&&o.a.createElement("div",{className:F.loading},o.a.createElement(R.a,null)),!i&&(c&&c.length>0?o.a.createElement(k.a,{className:F.list,columns:f,dataSource:c,defaultExpandAllRows:!0,expandIcon:function(e){if(e.expandable)return e.expanded?o.a.createElement("a",{className:F.expandTrigger,onClick:function(t){t.stopPropagation(),e.onExpand(e.record,t)}},o.a.createElement(M.default,{style:{fontSize:"12px",color:"#595959"}})):o.a.createElement("a",{className:F.expandTrigger,onClick:function(t){t.stopPropagation(),e.onExpand(e.record,t)}},o.a.createElement(U.default,{style:{fontSize:"12px",color:"#595959"}}))},indentSize:12,pagination:!1,rowKey:function(e){return e.data.productCode},onRow:function(e){return{onClick:function(t){return r.handleSelectCode(t,e)}}}}):o.a.createElement("div",{className:F.emptyTip},o.a.createElement("div",{className:F.img}),o.a.createElement("p",null,u?__("未搜索到与你相关的产品码，输入产品名搜索或去 {productCode} 添加",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))}):__("未搜索到相关产品码, 到 {productCode} 申请",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))}))))))};Z.propTypes={visible:s.a.bool.isRequired,onCancel:s.a.func.isRequired,onAddProductCode:s.a.func.isRequired,selectedCodes:s.a.array};var $=Z,K="Info-module_wrapper_cDOM9",ee="Info-module_block_sgefC",te="Info-module_blockTitle_rk05N",re="Info-module_blockTitleInline_3topf",ne="Info-module_required_S47QQ",ae="Info-module_placeholder_nQfZM",oe="Info-module_readonlyWrapper_ZRhQC",ie="Info-module_reviewerWrapper_ZiwCW",ce="Info-module_descText_JA99V",le="Info-module_btnAddReviewer_dTAt1",ue="Info-module_reviewerList_Rv+Px",se="Info-module_reviewerItemLite_0uWgx",de="Info-module_reviewerStatusWrapper_WK9wG",fe="Info-module_reviewerAvatarWrapper_rvpZE",pe="Info-module_rejectStatus_woOeh",me="Info-module_acceptedStatus_TL1Yk",ve="Info-module_incompleteStatus_hrNd+",he="Info-module_reviewerAvatar_GEw0V",ye="Info-module_reviewerName_BaP17",be="Info-module_reviewerItem_E9bva",we="Info-module_reviewerNameAndAvatar_sezG8",ge="Info-module_btnRemove_I2pQp",_e="Info-module_ccList_hEFdx",Ee="Info-module_ccName_HOdjG",Se="Info-module_descWrapper_NAdFl",Ce="Info-module_descInput_4PIAQ",Ne="Info-module_miniWrapper_8qIhN",je="Info-module_approveBtn_uQusK",Ae="Info-module_tooltip_qcsZd",Oe="Info-module_link_xW9Ia",xe="Info-module_startTime_c9M9N",Ie="Info-module_ccSep_a03J-",Te="Info-module_popoverWrapper_hPfWo",ke="Info-module_approveBtnWrapper_A8O-+",Re="Info-module_showMoreBtn_bg8HS",Le="Info-module_iconDown_NugP3",Pe="Info-module_iconRight_RQeR5",De="Info-module_baiyanWrapper_BzQfy",Me="Info-module_baiyanBtn_1qWwn",Ue="Info-module_baiyanDesc_srRM5",Fe="Info-module_errorText_7iHpe",We="Info-module_tasksWrapper_KYjB8",Ge="Info-module_taskList_FphTn",Be="Info-module_project_nxlTa",Ve="Info-module_milestone_TZ6sD",ze="Info-module_milestoneStatus_WYJXP",Ye="Info-module_taskItem_ND7fO",He="Info-module_taskItemEditable_Gu3I-";function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Qe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=qe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xe(e){return function(e){if(Array.isArray(e))return $e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ze(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||Ze(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ze(e,t){if(e){if("string"==typeof e)return $e(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$e(e,t):void 0}}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ke=function(e){var t=e.review,r=e.editable,n=e.target,o=Je(Object(a.useState)(t?A.formatUser(t.approvers):[]),2),i=o[0],c=o[1],l=Je(Object(a.useState)(t?A.formatUser(t.ccs):[]),2),u=l[0],s=l[1],d=Je(Object(a.useState)((null==t?void 0:t.product_codes)||[]),2),f=d[0],p=d[1],m=Je(Object(a.useState)(t?t.name:(null==n?void 0:n.title)||__("文档评审")),2),h=m[0],y=m[1],b=Je(Object(a.useState)(t?t.body:""),2),w=b[0],g=b[1],_=Je(Object(a.useState)(!1),2),E=_[0],C=_[1],N=Je(Object(a.useState)(!1),2),j=N[0],O=N[1],x=Je(Object(a.useState)(!1),2),I=x[0],T=x[1],k=Je(Object(a.useState)(!1),2),R=k[0],L=k[1],P=Je(Object(a.useState)(),2),D=P[0],M=P[1],U=Je(Object(a.useState)(),2),F=U[0],W=U[1],G=Je(Object(a.useState)(),2),B=G[0],V=G[1],z=Je(Object(a.useState)(),2),Y=z[0],H=z[1];return Object(a.useEffect)((function(){var t;t={},h||(t.name=__("评审名称不可为空")),(null==h?void 0:h.length)>128&&(t.name=__("评审名称最多不可超过 128 个字")),(null==w?void 0:w.length)>1e3&&(t.desc=__("评审描述最多不可超过 1000 个字")),(null==i?void 0:i.length)>20&&(t.approver=__("评审人数最多不可超过 20 人")),(null==u?void 0:u.length)>20&&(t.cc=__("抄送人数最多不可超过 20 人")),M(t.name),W(t.desc),V(t.approver),H(t.cc),e.onError(t)}),[h,w,i,u,r]),Object(S.a)(r&&R,__("评审尚未保存，确定离开页面？")),{state:{approvers:i,ccs:u,name:h,description:w,productCodes:f,approverModalVisible:E,ccModalVisible:j,productCodeModalVisible:I,nameErr:D,descErr:F,approverErr:B,ccErr:Y},toggleApproverModal:function(){C(!E)},toggleCcModal:function(){O(!j)},onAddApprovers:function(t){var r=[].concat(Xe(i),Xe(t));c(r),L(!0),e.onChangeApprovers(r),C(!1)},removeApprover:function(t){var r=Xe(i),n=r.findIndex((function(e){return e.user_id===t}));n<0||(r.splice(n,1),c(r),L(!0),e.onChangeApprovers(r))},onAddCcs:function(t){var r=window.appData,n=r.isYuque,a=r.me,o=n?"id":"work_id";if(t.find((function(e){return e[o]===a[o]})))v.a.error(__("不支持抄送给评审发起人"));else{var i=[].concat(Xe(u),Xe(t));s(i),L(!0),e.onChangeCcs(i),O(!1)}},removeCc:function(t){var r=Xe(u),n=r.findIndex((function(e){return e.user_id===t}));n<0||(r.splice(n,1),s(r),L(!0),e.onChangeCcs(r))},toggleProductCodeModal:function(){T(!I)},onAddProductCode:function(t){p(t),e.onChangeProductCodes(t),T(!1)},removeProductCode:function(t){var r=f.findIndex((function(e){return e.productCode===t}));if(-1!==r){var n=Xe(f);n.splice(r,1),p(n),e.onChangeProductCodes(n)}},onChangeDesc:function(t){var r=t.target.value;g(r),L(!0),e.onChangeDesc(r)},onChangeName:function(t){var r=t.target.value;y(r),L(!0),e.onChangeName(r)},resetEdit:function(){c(t?A.formatUser(t.approvers):[]),s(t?A.formatUser(t.ccs):[]),g(t?t.body:""),y(t?t.name:__("文档评审")),L(!1)}}},et=o.a.forwardRef((function(e,t){var r=e.editable,n=e.review,i=e.isMiniSize,c=r;n&&n.status!==d.STATUS.active&&(c=!1);var u=Ke(e),s=u.state,f=s.approvers,p=s.ccs,m=s.description,v=s.productCodes,h=s.name,y=s.approverModalVisible,S=s.ccModalVisible,C=s.productCodeModalVisible,N=s.nameErr,j=s.descErr,A=s.approverErr,T=s.ccErr,k=window.appData,R=k.organization,L=k.isYuque;return Object(a.useImperativeHandle)(t,(function(){return{resetEdit:function(){u.resetEdit()}}})),o.a.createElement("div",{className:l()(Qe(Qe(Qe({},K,!i),Ne,i),oe,!c))},o.a.createElement("div",{className:l()(Se,ee)},o.a.createElement("h6",{className:l()(te,ne)},__("评审名称")),c?o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a,{className:Ce,placeholder:__("请填写评审名称"),onChange:u.onChangeName,value:h}),N&&o.a.createElement("p",{className:Fe},N)):o.a.createElement("div",{className:ce},o.a.createElement("div",{"data-testid":"review-info-name"},h))),o.a.createElement("div",{className:l()(Se,ee)},o.a.createElement("h6",{className:te},__("描述")),c?o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a.TextArea,{autoSize:i?{minRows:2,maxRows:4}:{minRows:3,maxRows:6},className:Ce,placeholder:__("添加评审内容说明，帮助评审人快速了解评审重点"),onChange:u.onChangeDesc,value:m}),j&&o.a.createElement("p",{className:Fe},j)):o.a.createElement("div",{className:ce},m?o.a.createElement("div",{"data-testid":"review-info-desc"},o.a.createElement(I.a,{content:m,disableHeaderBr:!0})):o.a.createElement("p",{className:ae},__("无描述信息")))),o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:l()(te,ne)},__("评审人")),o.a.createElement("div",{className:ue},f&&f.map((function(e){return o.a.createElement("div",{className:be,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("a",{title:e.name,className:we},o.a.createElement(O.a,{src:e.avatar_url,size:24}),o.a.createElement("span",null,e.name),c&&o.a.createElement("a",{className:ge,onClick:function(){u.removeApprover(e.user_id)}},o.a.createElement(g.default,{width:16,height:16}))))})),c&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:le,onClick:u.toggleApproverModal},o.a.createElement(_.default,null)),o.a.createElement(x.a,{type:"simple",visible:y,disableSelectors:R?["addrbook"]:[],enableDepSelect:!1,organization:R,members:f,onCancel:u.toggleApproverModal,onSubmit:u.onAddApprovers})),A&&o.a.createElement("p",{className:Fe},A))),o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:te},__("抄送")),o.a.createElement("div",{className:ue},p&&p.map((function(e){return o.a.createElement("div",{className:be,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("a",{title:e.name,className:we},o.a.createElement(O.a,{src:e.avatar_url,size:24}),o.a.createElement("span",null,e.name),c&&o.a.createElement("a",{className:ge,onClick:function(){u.removeCc(e.user_id)}},o.a.createElement(g.default,{width:16,height:16}))))})),c&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:le,onClick:u.toggleCcModal},o.a.createElement(_.default,null)),o.a.createElement(x.a,{type:"simple",visible:S,disableSelectors:R?["addrbook"]:[],enableDepSelect:!1,organization:R,members:p,onCancel:u.toggleCcModal,onSubmit:u.onAddCcs})),T&&o.a.createElement("p",{className:Fe},T))),!L&&c&&o.a.createElement("div",{className:l()(We,ee)},o.a.createElement("h6",{className:te},__("关联产品码"),o.a.createElement(b.a,{overlayClassName:Ae,title:o.a.createElement("span",null,__("产品码是产品资产的唯一标识，详见 {productCode}",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/encyclopedia",target:"_blank",className:Oe},__("产品星球"))}))},o.a.createElement(E.default,{style:{marginLeft:8,color:"#8C8C8C"}}))),o.a.createElement("div",{className:Ge},v.map((function(e){return o.a.createElement("div",{key:e.productCode,className:l()(Ye,Qe({},He,c))},o.a.createElement(b.a,{title:__("产品名称：{name}",{name:e.productName}),placement:"top"},o.a.createElement("a",{target:"_blank",className:Be,href:"https://pd.alipay.com/#/product/main?productCode=".concat(e.productCode),title:e.productName},e.productName)),o.a.createElement(b.a,{title:__("产品码：{code}",{code:e.productCode}),placement:"top"},o.a.createElement("span",{className:Ve},e.productCode)),o.a.createElement(b.a,{title:__("产品负责人：{owner}",{owner:e.pdOwner||__("暂无")}),placement:"top"},o.a.createElement("span",{className:ze},e.pdOwner||__("暂无"))),c&&o.a.createElement("a",{className:ge,onClick:function(){u.removeProductCode(e.productCode)}},o.a.createElement(g.default,{width:16,height:16})))}))),o.a.createElement("a",{onClick:u.toggleProductCodeModal,className:le},o.a.createElement(_.default,null)),C&&o.a.createElement($,{visible:C,onCancel:u.toggleProductCodeModal,onAddProductCode:u.onAddProductCode,selectedCodes:v||[]})))}));et.defaultProps={onError:function(){}},et.propTypes={review:s.a.object,editable:s.a.bool,onChangeApprovers:s.a.func,onChangeCcs:s.a.func,onChangeProductCodes:s.a.func,onChangeDesc:s.a.func,onChangeName:s.a.func,onError:s.a.func,isMiniSize:s.a.bool,doc:s.a.object};var tt=et,rt={wrapper:"Create-module_wrapper_Jiqsh",header:"Create-module_header_kF7DM",headerTitle:"Create-module_headerTitle_KBZT5",headerReviewName:"Create-module_headerReviewName_zLDNP",headerActions:"Create-module_headerActions_GCU7X",footer:"Create-module_footer_IQYrY",btn:"Create-module_btn_KC5H4",fullBtn:"Create-module_fullBtn_jieFd",whiteBtn:"Create-module_whiteBtn_1TkFL",approveBtn:"Create-module_approveBtn_CmlKW",btnCancel:"Create-module_btnCancel_F4e8g",descInput:"Create-module_descInput_vUru2",footerNoBorder:"Create-module_footerNoBorder_CQL+E",tooltip:"Create-module_tooltip_lsslV",miniWrapper:"Create-module_miniWrapper_1npMe",reviewBtn:"Create-module_reviewBtn_+oRG+",handleWrapper:"Create-module_handleWrapper_txASJ"};function nt(e){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function at(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=nt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==nt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ot(){ot=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),c=new I(n||[]);return a(i,"_invoke",{value:j(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",h={};function y(){}function b(){}function w(){}var g={};u(g,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(T([])));E&&E!==r&&n.call(E,i)&&(g=E);var S=w.prototype=y.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function r(a,o,i,c){var l=d(e[a],e,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==nt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function j(t,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=A(c,n);if(l){if(l===h)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=d(t,r,n);if("normal"===u.type){if(a=n.done?v:p,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=v,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=d(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,h;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(nt(t)+" is not iterable")}return b.prototype=w,a(S,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(N.prototype),u(N.prototype,c,(function(){return this})),t.AsyncIterator=N,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new N(s(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(S),u(S,l,"Generator"),u(S,i,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return c.type="throw",c.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function it(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return lt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?lt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ut=function(e){var t,r,n=ct(Object(a.useState)([]),2),o=n[0],i=n[1],c=ct(Object(a.useState)([]),2),l=c[0],u=c[1],s=ct(Object(a.useState)(),2),d=s[0],f=s[1],p=ct(Object(a.useState)(),2),m=p[0],b=p[1],w=ct(Object(a.useState)(),2),g=w[0],_=w[1],E=ct(Object(a.useState)(!1),2),S=E[0],C=E[1],N=ct(Object(a.useState)(),2),j=N[0],A=N[1];return{state:{approvers:o,ccs:l,submitting:S,errorMsg:j},onError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e[r]){t=!0,A(e[r]);break}t||A()},onChangeApprovers:function(e){i(e)},onChangeCcs:function(e){u(e)},onChangeProductCodes:function(e){f(e)},onChangeDesc:function(e){b(e)},onChangeName:function(e){_(e)},onSubmit:(t=ot().mark((function t(){var r,n,a,i,c,u;return ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!S&&!j){t.next=2;break}return t.abrupt("return");case 2:return C(!0),r={target_type:e.targetType,target_id:e.target.id},void 0!==m&&(r.body=m),r.name=g||__("文档评审"),d&&(r.product_codes=d),o&&(window.appData.isYuque?(n=o.filter((function(e){return y.a.isDepartment(e)})),a=o.filter((function(e){return y.a.isUser(e)})),r.approver_ids=a.map((function(e){return e.user_id})),r.approver_department_ids=n.map((function(e){return e.id}))):r.approver_work_ids=o.map((function(e){return e.work_id}))),l&&(window.appData.isYuque?(i=l.filter((function(e){return y.a.isDepartment(e)})),c=l.filter((function(e){return y.a.isUser(e)})),r.cc_ids=c.map((function(e){return e.user_id})),r.cc_department_ids=i.map((function(e){return e.id}))):r.cc_work_ids=l.map((function(e){return e.work_id}))),t.prev=9,t.next=12,h.a.reviews.create(r);case 12:u=t.sent,C(!1),v.a.success(__("已成功发起评审")),e.onCreateReview(u),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(9),C(!1);case 21:case"end":return t.stop()}}),t,null,[[9,18]])})),r=function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(e){it(o,n,a,i,c,"next",e)}function c(e){it(o,n,a,i,c,"throw",e)}i(void 0)}))},function(){return r.apply(this,arguments)})}},st=function(e){var t=ut(e),r=e.target,n=t.state,a=n.submitting,i=n.approvers,c=n.ccs,u=n.errorMsg,s=e.isMiniSize,f=i&&i.length>0&&i.length<=d.MAX_APPROVER_NUM,p=c&&c.length<=d.MAX_CC_NUM;return o.a.createElement("div",{className:l()("review-create-module",at(at({},rt.wrapper,!s),rt.miniWrapper,s))},o.a.createElement("div",{className:rt.body},o.a.createElement(tt,{target:r,onChangeApprovers:t.onChangeApprovers,onChangeCcs:t.onChangeCcs,onChangeProductCodes:t.onChangeProductCodes,onChangeDesc:t.onChangeDesc,onChangeName:t.onChangeName,onError:t.onError,isMiniSize:s,editable:!0})),o.a.createElement("div",{className:l()(rt.footer,rt.footerNoBorder)},o.a.createElement("span",null,o.a.createElement(m.a,{"data-testid":"btn-submit",className:rt.btn,type:"primary",disabled:a||!f||!p||u,onClick:t.onSubmit},__("发起评审"))),o.a.createElement(m.a,{"data-testid":"btn-cancel",className:rt.btn,onClick:e.onCancel},__("取消"))))};st.propTypes={target:s.a.object.isRequired,targetType:s.a.oneOf(["Doc"]).isRequired,onCancel:s.a.func.isRequired,onCreateReview:s.a.func.isRequired,isMiniSize:s.a.bool,doc:s.a.object};var dt=st,ft=(r(179),r(60)),pt=r(1521),mt=r(1493),vt=(r(905),r(542)),ht=r(15),yt=r.n(ht),bt=r(280);function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function gt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=wt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==wt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Et(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Et(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var St=o.a.forwardRef((function(e,t){var r,n,i=_t(Object(a.useState)(!1),2),c=i[0],u=i[1],s=e.review,p=e.isMiniSize,v=e.isApprover,h=e.isHistoryReview,y=e.doc,w=A.formatUser(s.approvers),g=A.formatUser(s.ccs),_=s.product_codes,E=window.appData,S=E.me,C=E.defaultSpaceHost,N=w.find((function(e){return e.id===S.id}))||{},j=N.isCompleted,x=window.appData.isYuque,T=g&&g.length>0,k=!x&&_&&_.length>0,R=!window.h5,L="".concat(C,"/go/doc/").concat(y.id),P="".concat(C,"/").concat(null==s||null===(r=s.meta)||void 0===r?void 0:r.versionUrl),D=encodeURIComponent('<p>评审文档：<a href="'.concat(L,'">').concat(L,'</a></p><p>评审文档快照：<a href="').concat(P,'">').concat(P,"</a></p>")),M="https://baiyan.alipay.com/task/create?type=REQUIREMENT&name=".concat(y.title,"&lakeContent=").concat(D,"&userScope=1"),U=function(){return o.a.createElement(o.a.Fragment,null,T&&o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:te},__("抄送")),o.a.createElement("p",null,o.a.createElement("span",{className:_e},g&&g.map((function(e,t){return o.a.createElement("span",{className:Ee,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement(mt.a,{user:e},o.a.createElement("span",null,e.name)),o.a.createElement("span",{className:Ie},"、"))}))))),o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:te},__("发起时间")),o.a.createElement("p",{className:xe},yt()(s.created_at).format("YYYY-MM-DD HH:mm"))))};return o.a.createElement("div",{className:l()(gt(gt({},K,!p),Ne,p))},s.body&&o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:l()(te,re)},__("描述")),o.a.createElement("div",null,s.body?o.a.createElement("div",{"data-testid":"review-info-desc"},o.a.createElement(I.a,{content:s.body,disableHeaderBr:!0})):o.a.createElement("p",{className:ae},__("无描述信息")))),v&&!h&&!j&&s.status===d.STATUS.active&&o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:l()(te,re)},__("请投票")),o.a.createElement("div",null,o.a.createElement("div",{className:ke},o.a.createElement(m.a,{onClick:function(){return e.onSubmitApproval(d.REVIEWER_STATUS.accepted)},className:je},o.a.createElement("img",{src:"https://gw.alipayobjects.com/zos/bmw-prod/8a0ad84c-9110-47bc-8110-871abaeaed04.svg",width:20,style:{marginRight:2}}),__("通过")),o.a.createElement(m.a,{onClick:function(){return e.onSubmitApproval(d.REVIEWER_STATUS.rejected)},className:je},o.a.createElement("img",{src:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*EMY3Q7SajTMAAAAAAAAAAAAAARQnAQ",width:24}),__("不通过"))))),w&&!!w.length&&o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:te},__("评审人")),o.a.createElement("div",{className:ue},w&&w.map((function(e){return o.a.createElement("p",{className:se,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("span",{className:fe},o.a.createElement(mt.a,{user:e},o.a.createElement(O.a,{src:e.avatar_url,size:28,className:he}),o.a.createElement("span",{className:ye},e.name))),o.a.createElement("span",{className:de},function(e){switch(e.reviewStatus){case d.REVIEWER_STATUS.accepted:return o.a.createElement("span",{className:me},__("通过"));case d.REVIEWER_STATUS.rejected:return o.a.createElement("span",{className:pe},__("不通过"));case d.REVIEWER_STATUS.incomplete:default:return o.a.createElement("span",{className:ve},__("未评审"))}}(e)))})))),k&&o.a.createElement("div",{className:l()(We,ee)},o.a.createElement("h6",{className:te},__("关联产品码")),o.a.createElement("div",{className:Ge},_.map((function(e){return o.a.createElement("div",{key:e.productCode,className:Ye},o.a.createElement(b.a,{title:__("产品名称：{name}",{name:e.productName}),placement:"top"},o.a.createElement("a",{target:"_blank",className:Be,href:"https://pd.alipay.com/#/product/main?productCode=".concat(e.productCode),title:e.productName},e.productName)),o.a.createElement(b.a,{title:__("产品码：{code}",{code:e.productCode}),placement:"top"},o.a.createElement("span",{className:Ve},e.productCode)),o.a.createElement(b.a,{title:__("产品负责人：{owner}",{owner:e.pdOwner||__("暂无")}),placement:"top"},o.a.createElement("span",{className:ze},e.pdOwner||__("暂无"))))})))),s.status!==d.STATUS.active&&s.meta&&s.meta.versionUrl&&o.a.createElement("div",{className:l()(ie,ee)},o.a.createElement("h6",{className:te},__("结束时间")),o.a.createElement("p",{className:xe},o.a.createElement("a",{href:"".concat(window.appData.defaultSpaceHost,"/").concat(s.meta.versionUrl),target:"_blank"},yt()(s.updated_at).format("YYYY-MM-DD HH:mm")))),R&&!window.h5&&o.a.createElement(vt.a,{placement:"topLeft",arrowPointAtCenter:!0,content:o.a.createElement("div",{className:Te},U())},o.a.createElement("span",{className:te},__("更多#Review"))),window.h5&&o.a.createElement("div",null,o.a.createElement("span",{className:Re,onClick:function(){return u(!c)}},c?o.a.createElement(f.b,{className:Le,name:"review-arrow-down",width:8}):o.a.createElement(f.b,{className:Pe,name:"review-arrow-right",width:8}),__("更多")),c&&U()),!window.h5&&!x&&(null==s?void 0:s.status)===d.STATUS.accepted&&!h&&(null==s||null===(n=s.meta)||void 0===n?void 0:n.versionUrl)&&o.a.createElement("div",{className:De},o.a.createElement("a",{href:M,target:"_blank"},o.a.createElement(m.a,{className:Me},__("创建白雁工作项"))),o.a.createElement("p",{className:Ue},__("让需求高效执行跟进"))))}));St.propTypes={doc:s.a.object,review:s.a.object,isMiniSize:s.a.bool,isHistoryReview:s.a.bool,isApprover:s.a.bool,onSubmitApproval:s.a.func};var Ct=Object(bt.b)(Object(i.d)((function(e){return{doc:e.doc}}))(St),!0),Nt=r(176),jt=r.n(Nt);function At(e){var t,r,n=window.appData.locale;switch(null===(t=e.review)||void 0===t?void 0:t.status){case d.STATUS.accepted:r="accepted".concat(jt()(n));break;case d.STATUS.rejected:r="rejected".concat(jt()(n));break;case d.STATUS.cancelled:r="cancelled".concat(jt()(n))}return r?o.a.createElement("div",{className:l()("reviewStamp",r)}):null}At.propTypes={review:s.a.object};var Ot=At;function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function It(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=xt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=xt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==xt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tt(){Tt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),c=new I(n||[]);return a(i,"_invoke",{value:j(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",h={};function y(){}function b(){}function w(){}var g={};u(g,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(T([])));E&&E!==r&&n.call(E,i)&&(g=E);var S=w.prototype=y.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function r(a,o,i,c){var l=d(e[a],e,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==xt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function j(t,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=A(c,n);if(l){if(l===h)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=d(t,r,n);if("normal"===u.type){if(a=n.done?v:p,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=v,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=d(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,h;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(xt(t)+" is not iterable")}return b.prototype=w,a(S,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(N.prototype),u(N.prototype,c,(function(){return this})),t.AsyncIterator=N,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new N(s(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(S),u(S,l,"Generator"),u(S,i,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return c.type="throw",c.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function kt(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function Rt(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){kt(o,n,a,i,c,"next",e)}function c(e){kt(o,n,a,i,c,"throw",e)}i(void 0)}))}}function Lt(e){return function(e){if(Array.isArray(e))return Mt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Dt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||Dt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(e,t){if(e){if("string"==typeof e)return Mt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Mt(e,t):void 0}}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ut=function(e){var t=e.review,r=e.isMiniSize,n=e.isApprover,i=e.isHistoryReview,c=function(e){var t,r,n,i=e.review,c=Pt(Object(a.useState)(i.approvers?Lt(i.approvers):[]),2),l=c[0],u=c[1],s=Pt(Object(a.useState)(i.ccs?Lt(i.ccs):[]),2),f=s[0],p=s[1],m=Pt(Object(a.useState)((null==i?void 0:i.product_codes)||[]),2),b=m[0],w=m[1],g=Pt(Object(a.useState)(),2),_=g[0],E=g[1],S=Pt(Object(a.useState)(),2),C=S[0],N=S[1],j=Pt(Object(a.useState)(!1),2),A=j[0],O=j[1],x=Pt(Object(a.useState)(!1),2),I=x[0],T=x[1],k=Pt(Object(a.useState)(),2),R=k[0],L=k[1],P=o.a.createRef();return{state:{ccs:f,approvers:l,submitting:A,isEditing:I,errorMsg:R},infoRef:P,onError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e[r]){t=!0,L(e[r]);break}t||L()},onChangeApprovers:function(e){u(e)},onChangeCcs:function(e){p(e)},onChangeProductCodes:function(e){w(e)},onChangeDesc:function(e){E(e)},onChangeName:function(e){N(e)},startEdit:function(){T(!0)},cancelEdit:function(){T(!1),L(),P.current&&P.current.resetEdit()},finishEdit:(n=Rt(Tt().mark((function t(){var r,n,a,o,c,u;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A&&!R){t.next=2;break}return t.abrupt("return");case 2:return O(!0),r={id:i.id},void 0!==_&&(r.body=_),C&&(r.name=C),l&&(window.appData.isYuque?(n=l.filter((function(e){return y.a.isDepartment(e)})),a=l.filter((function(e){return y.a.isUser(e)})),r.approver_ids=a.map((function(e){return e.user_id})),r.approver_department_ids=n.map((function(e){return e.id}))):r.approver_work_ids=l.map((function(e){return e.work_id}))),f&&(window.appData.isYuque?(o=f.filter((function(e){return y.a.isDepartment(e)})),c=f.filter((function(e){return y.a.isUser(e)})),r.cc_ids=c.map((function(e){return e.user_id})),r.cc_department_ids=o.map((function(e){return e.id}))):r.cc_work_ids=f.map((function(e){return e.work_id}))),r.product_codes=b||[],t.prev=9,t.next=12,h.a.reviews.update(r);case 12:u=t.sent,O(!1),T(!1),e.updateActiveReview(u),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(9),O(!1);case 21:case"end":return t.stop()}}),t,null,[[9,18]])}))),function(){return n.apply(this,arguments)}),onSubmitApproval:(r=Rt(Tt().mark((function t(r){var n;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A){t.next=2;break}return t.abrupt("return");case 2:return O(!0),t.next=5,h.a.reviews.reviewTarget({id:i.id,status:r});case 5:n=t.sent,r!==d.REVIEWER_STATUS.incomplete&&v.a.success(__("已成功提交评审意见")),O(!1),e.updateActiveReview(n);case 9:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)}),onCancelReview:(t=Rt(Tt().mark((function t(r){var n;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A){t.next=2;break}return t.abrupt("return");case 2:return O(!0),t.next=5,h.a.reviews.cancelReview({id:i.id,status:r});case 5:n=t.sent,O(!1),e.updateActiveReview(n);case 8:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}}(e),u=c.state,s=u.submitting,f=u.isEditing,p=u.ccs,w=u.approvers,g=u.errorMsg,_=w&&w.length>0&&w.length<=d.MAX_APPROVER_NUM,E=p&&p.length<=d.MAX_CC_NUM,S=!!t.approvers.find((function(e){return e.id===t.user_id})),C=!!t.approvers.find((function(e){return e.id===t.user_id&&e.isCompleted}));return o.a.createElement("div",{className:l()(It(It(It({},rt.wrapper,!r),rt.miniWrapper,r),rt.miniFolding,r))},!f&&o.a.createElement("div",{className:rt.header},o.a.createElement("div",{className:rt.headerTitle},t.status!==d.STATUS.active?o.a.createElement("span",{className:rt.headerReviewName},t.name):o.a.createElement(o.a.Fragment,null,!S&&o.a.createElement("span",{className:rt.headerReviewName},t.name),S&&t.user&&__("{user} 邀你评审 {target}",{user:o.a.createElement(mt.a,{user:t.user},o.a.createElement("a",{href:"/".concat(t.user.login)},t.user.name)),target:o.a.createElement("span",{className:rt.headerReviewName},t.name)}),S&&t.status===d.STATUS.active&&o.a.createElement("div",{className:rt.headerActions},!f&&o.a.createElement("a",{onClick:c.startEdit},o.a.createElement(pt.default,null)," ",__("编辑")))))),o.a.createElement("div",{className:l()(rt.body,rt.stampWrapper)},f?o.a.createElement(tt,{review:t,onChangeApprovers:c.onChangeApprovers,onChangeCcs:c.onChangeCcs,onChangeProductCodes:c.onChangeProductCodes,onChangeDesc:c.onChangeDesc,onChangeName:c.onChangeName,onError:c.onError,editable:f,isMiniSize:r,ref:c.infoRef,isApprover:n}):o.a.createElement(Ct,{isHistoryReview:i,review:t,isMiniSize:r,isApprover:n,onSubmitApproval:c.onSubmitApproval}),o.a.createElement(Ot,{review:t})),!i&&t.status===d.STATUS.active&&o.a.createElement(o.a.Fragment,null,f?o.a.createElement("div",{className:l()(rt.footer,rt.footerNoBorder)},o.a.createElement(b.a,{placement:"top",title:g,className:g?rt.tooltip:{}},o.a.createElement(m.a,{onClick:c.finishEdit,disabled:s||!_||!E||g,type:"primary",className:rt.btn},__("完成"))),o.a.createElement(m.a,{onClick:c.cancelEdit,disabled:s},__("取消"))):o.a.createElement("div",{className:l()(rt.footer,rt.footerNoBorder)},S?o.a.createElement(o.a.Fragment,null,C?o.a.createElement(m.a,{disabled:s,onClick:function(){return c.onSubmitApproval(d.REVIEWER_STATUS.incomplete)},className:l()(rt.btn,rt.whiteBtn)},__("重新投票")):null):o.a.createElement(m.a,{disabled:s,type:"primary",className:rt.btn,onClick:c.startEdit},__("编辑评审")),o.a.createElement(ft.a,{title:__("确认取消评审？"),onConfirm:function(){c.onCancelReview(d.STATUS.cancelled)}},o.a.createElement(m.a,{disabled:s,className:l()(rt.btn,rt.whiteBtn)},__("取消评审"))))))};Ut.propTypes={review:s.a.object.isRequired,isMiniSize:s.a.bool,isHistoryReview:s.a.bool,updateActiveReview:s.a.func,isApprover:s.a.bool};var Ft=Ut;function Wt(e){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt(e)}function Gt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=Wt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Wt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bt(){Bt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),c=new I(n||[]);return a(i,"_invoke",{value:j(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",h={};function y(){}function b(){}function w(){}var g={};u(g,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(T([])));E&&E!==r&&n.call(E,i)&&(g=E);var S=w.prototype=y.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function r(a,o,i,c){var l=d(e[a],e,o);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==Wt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function j(t,r,n){var a=f;return function(o,i){if(a===m)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var c=n.delegate;if(c){var l=A(c,n);if(l){if(l===h)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===f)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=d(t,r,n);if("normal"===u.type){if(a=n.done?v:p,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=v,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=d(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,h;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(Wt(t)+" is not iterable")}return b.prototype=w,a(S,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(N.prototype),u(N.prototype,c,(function(){return this})),t.AsyncIterator=N,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new N(s(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(S),u(S,l,"Generator"),u(S,i,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return c.type="throw",c.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function Vt(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Yt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ht=function(e){var t,r,n=e.review,o=e.updateActiveReview,i=zt(Object(a.useState)(!1),2),c=i[0],l=i[1];return{state:{submitting:c},onSubmitApproval:(t=Bt().mark((function e(t){var r;return Bt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,h.a.reviews.reviewTarget({id:n.id,status:t});case 3:r=e.sent,t!==d.REVIEWER_STATUS.incomplete&&v.a.success(__("已成功提交评审意见")),l(!1),o(r);case 7:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(e){Vt(o,n,a,i,c,"next",e)}function c(e){Vt(o,n,a,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})}};function qt(e){var t=Ht(e),r=e.review,n=e.isApprover,a=window.appData.me,i=r.approvers.find((function(e){return e.id===a.id}))||{},c=i.isCompleted;return o.a.createElement("div",{className:l()(rt.wrapper,rt.handleWrapper,Gt(Gt({},rt.wrapper,!window.h5),rt.miniWrapper,window.h5))},o.a.createElement("div",{className:rt.header},o.a.createElement("div",{className:rt.headerTitle},r.status!==d.STATUS.active?o.a.createElement("span",{className:rt.headerReviewName},r.name):o.a.createElement(o.a.Fragment,null,!n&&o.a.createElement("span",{className:rt.headerReviewName},r.name),n&&r.user&&r.status===d.STATUS.active&&__("{user} 邀你评审 {target}",{user:o.a.createElement(mt.a,{user:r.user},o.a.createElement("a",{href:"/".concat(r.user.login)},r.user.name)),target:o.a.createElement("span",{className:rt.headerReviewName},r.name)})))),o.a.createElement(Ct,{review:r,isApprover:n,onSubmitApproval:t.onSubmitApproval}),c&&n&&r.status===d.STATUS.active&&o.a.createElement("div",{className:l()(rt.footer,rt.footerNoBorder)},o.a.createElement(m.a,{disabled:t.state.submitting,onClick:function(){return t.onSubmitApproval(d.REVIEWER_STATUS.incomplete)},className:l()(rt.btn,rt.whiteBtn,rt.fullBtn)},__("重新投票"))),o.a.createElement(Ot,{review:r}))}qt.propTypes={review:s.a.object,isApprover:s.a.bool};var Qt=Object(bt.b)(qt,!0),Xt=r(152),Jt=r(1251),Zt={drawer:"ReviewDrawer-module_drawer_6qnGd",header:"ReviewDrawer-module_header_NHY+y",miniHeader:"ReviewDrawer-module_miniHeader_3qcob",left:"ReviewDrawer-module_left_PAF6a",leftIconWrapper:"ReviewDrawer-module_leftIconWrapper_OuZ6c",backIcon:"ReviewDrawer-module_backIcon_fAC1b",text:"ReviewDrawer-module_text_dGN2k",right:"ReviewDrawer-module_right_f56vw",closeIcon:"ReviewDrawer-module_closeIcon_kcD+E",historyItem:"ReviewDrawer-module_historyItem_Jr41Q",card:"ReviewDrawer-module_card_Md17c",btnFold:"ReviewDrawer-module_btnFold_V2x03",btnFoldText:"ReviewDrawer-module_btnFoldText_CyWwp",isFolding:"ReviewDrawer-module_isFolding_mL2+P",isUnfolding:"ReviewDrawer-module_isUnfolding_ijwrL",h5Drawer:"ReviewDrawer-module_h5Drawer_wy-pi",historySep:"ReviewDrawer-module_historySep_7uX+R",historyIcon:"ReviewDrawer-module_historyIcon_-rCE8",foldingIcon:"ReviewDrawer-module_foldingIcon_B7TtL",btnFoldIcon:"ReviewDrawer-module_btnFoldIcon_CQTy6"};function $t(e){return $t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$t(e)}function Kt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=$t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=$t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$t(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function er(e){return function(e){if(Array.isArray(e))return nr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||rr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||rr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rr(e,t){if(e){if("string"==typeof e)return nr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nr(e,t):void 0}}function nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ar="create",or="handle",ir=function(e){var t=e.me,r=e.doc,n=e.dispatch,o=tr(Object(a.useState)(null),2),i=o[0],c=o[1],l=tr(Object(a.useState)(!1),2),u=l[0],s=l[1],f=tr(Object(a.useState)(!1),2),p=f[0],m=f[1],v=tr(Object(a.useState)(!0),2),h=v[0],y=v[1],b=tr(Object(a.useState)(e.status||or),2),w=b[0],g=b[1],_=tr(Object(a.useState)([]),2),E=_[0],S=_[1],C=!!(i&&i.approvers&&i.approvers.length>0)&&!!i.approvers.find((function(e){return e.id===(null==t?void 0:t.id)})),N=!!(i&&i.approvers&&i.approvers.length>0)&&!!i.approvers.find((function(e){return e.id===(null==t?void 0:t.id)&&e.isCompleted})),j=function(e){if(e){if(e.product_codes&&e.product_codes.length>0)try{e.product_codes=e.product_codes.map((function(e){return"string"==typeof e?JSON.parse(e):e}))}catch(t){e.product_codes=[]}e.name||(e.name=__("文档评审"))}},A=function(e){j(e),c(e)},O=function(e){if(e.length){var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rr(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;j(n)}}catch(e){r.e(e)}finally{r.f()}S(e)}};return{state:{activeReview:i,visible:u,disableDispatchEvent:p,isFolding:h,drawerStatus:w,historyReview:E,isApprover:C,isApproverCompleted:N},resetAll:function(e){c(null),S([]),s(!1),n({type:"review/update",payload:{latestReviewStatus:null==e?void 0:e.latestReviewStatus,showReviewDrawer:(null==e?void 0:e.latestReviewStatus)===d.STATUS.active,showCreateReviewDrawer:!1}})},setDrawerStatus:g,setVisible:s,setDisableDispatchEvent:m,onClose:function(){m(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),s(!1)},onVisibleChange:function(e){var t=new CustomEvent("contentSidebarVisibleChange",{detail:{visible:e,type:"review"}});window.dispatchEvent(t)},onToggleFold:function(){return y(!h)},fetchReviews:function(){(null==r?void 0:r.latestReviewStatus)<0?s(!1):Xt.webProxy.reviews.getReviewsByTarget({target_type:"Doc",target_id:r.id}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];g(or);var t=e.shift();A(t),O(e),(null==t?void 0:t.status)===d.STATUS.active&&s(!0),n({type:"review/update",payload:{activeReview:t,historyReview:e}})}))},updateActiveReview:function(e){A(e);var t={activeReview:e,showReviewDrawer:!0};e.status===d.STATUS.cancelled&&(t.showCreateReviewDrawer=!1),n({type:"review/update",payload:t})},createReview:function(e){g(or);var t=i?[i].concat(er(E)):E;A(e),S(t),n({type:"review/update",payload:{activeReview:e,historyReview:E,showReviewDrawer:!0,showCreateReviewDrawer:!1}})},cancelCreateReview:function(){i?g(or):s(!1)}}},cr=Object(a.forwardRef)((function(e,t){var r=e.me,i=e.doc,c=e.review,u=e.sidePanelManager,s=window.h5,m=ir(e),v=m.onClose,h=m.onVisibleChange,y=m.onToggleFold,b=m.fetchReviews,w=m.setDrawerStatus,g=m.setVisible,_=m.setDisableDispatchEvent,E=m.resetAll,S=m.state,C=S.activeReview,N=S.visible,j=S.disableDispatchEvent,A=S.isFolding,O=S.drawerStatus,x=S.historyReview,I=S.isApprover,T=S.isApproverCompleted;function k(e){var t=e.onLayout;return Object(a.useEffect)((function(){return t({width:305}),function(){g(!1)}}),[]),null}Object(a.useEffect)((function(){var e=!0,t=or;(null==C?void 0:C.status)!==d.STATUS.active&&(e=!1),c.showReviewDrawer&&C&&(e=!0,t=or),c.showCreateReviewDrawer&&(null==C?void 0:C.status)!==d.STATUS.active&&(e=!0,t=ar),C&&"#opendrawer"===window.location.hash&&(e=!0,t=or,window.location.hash=""),g(e),w(t)}),[c]),Object(Jt.a)((function(){window.__readerEditMode||(c.activeReview&&E(i),b())}),[i.id]),Object(a.useEffect)((function(){j||h(N),_(!1),N&&(null==u||u.show("Review"))}),[N]),Object(a.useEffect)((function(){null==u||u.registerContent("Review",k)}),[]),Object(a.useImperativeHandle)(t,(function(){return{onClose:v}}));var R=Object(p.b)().rightSidebarWidth;if(!C&&O!==ar)return null;if(window.h5&&(C.status!==d.STATUS.active||T||!I))return null;var L=function(){return x.map((function(e){return o.a.createElement("div",{className:Zt.historyItem},o.a.createElement(Ft,{isHistoryReview:!0,target:i,targetType:"Doc",review:e,isApprover:I,editable:!1,updateActiveReview:m.updateActiveReview,isMiniSize:s}))}))},P=o.a.createElement("div",{className:l()(Zt.header,Kt({},Zt.miniHeader,s))},o.a.createElement("div",{className:Zt.left},c.isFromTab?o.a.createElement("div",{className:Zt.leftIconWrapper,onClick:function(){null==u||u.show("MoreFeature")}},o.a.createElement(f.b,{name:"arrow-left",className:Zt.backIcon})):null,o.a.createElement("span",{className:Zt.text},O===ar?__("发起评审"):__("评审"))),o.a.createElement("div",{className:Zt.right,onClick:function(){v(!1),null==u||u.hide()}},o.a.createElement(f.b,{name:"close",className:Zt.closeIcon})));return o.a.createElement(n.a,{title:P,closable:!1,placement:s?"bottom":"right",mask:s,zIndex:1e3,visible:N,className:l()(Zt.drawer,Kt({},Zt.h5Drawer,s)),style:{right:R},width:306},o.a.createElement("div",{className:Zt.wrapper},C&&O===or&&o.a.createElement(o.a.Fragment,null,C.user_id===(null==r?void 0:r.id)?o.a.createElement("div",{className:Zt.reviewInfo,id:"active-review","data-testid":"active-review"},o.a.createElement(Ft,{target:i,targetType:"Doc",review:C,isApprover:I,editable:i.abilities.update,updateActiveReview:m.updateActiveReview,isMiniSize:s})):o.a.createElement("div",{id:"reviewForm"},o.a.createElement(Qt,{review:C,isApprover:I,updateActiveReview:m.updateActiveReview})),!!x.length&&o.a.createElement(o.a.Fragment,null,window.h5?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:Zt.historySep},__("历史评审")),o.a.createElement("div",null,L())):o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:Zt.btnFold,onClick:y},A?o.a.createElement(f.b,{className:l()(Zt.btnFoldIcon,Zt.iconRight),name:"review-arrow-right",width:16}):o.a.createElement(f.b,{className:l()(Zt.btnFoldIcon,Zt.iconDown),name:"review-arrow-down",width:16}),o.a.createElement("span",{className:Zt.btnFoldText},__("历史评审"))),o.a.createElement("div",{className:A?Zt.isFolding:Zt.isUnfolding},L())))),O===ar&&o.a.createElement("div",{className:Zt.reviewInfo},o.a.createElement(dt,{target:i,targetType:"Doc",onCreateReview:m.createReview,onCancel:m.cancelCreateReview,isMiniSize:s}))))}));cr.propTypes={doc:s.a.object,me:s.a.object,dispatch:s.a.func,review:s.a.object,sidePanelManager:s.a.object};t.default=Object(i.d)((function(e){return{me:e.me,dispatch:e.dispatch,review:e.review,doc:e.doc}}),null,null,{forwardRef:!0})(cr)},813:function(e,t,r){"use strict";r(2873);var n=r(915),a=r(57),o=r.n(a),i=r(50),c=r.n(i),l=r(1262),u=r.n(l),s=r(65),d=r.n(s),f=r(143),p=r.n(f),m=r(0),v=r.n(m),h=r(4),y=r.n(h),b=r(6),w=r.n(b),g=r(66),_=r.n(g),E=r(162),S=r.n(E);var C=r(55),N=r.n(C)()("useInifiniteScroll"),j=function(e,t){var r,n,a,o,i,c,l=(r=!1,n=Object(m.useState)(r),a=S()(n,2),o=a[0],i=a[1],(c=Object(m.useRef)(o)).current=o,[o,i,Object(m.useCallback)((function(){return c.current}),[])]),s=S()(l,3),d=s[0],f=s[1],v=s[2],h=Object(m.useRef)(null);h.current=e;var y=Object(m.useCallback)(function(){var e=u()(p.a.mark((function e(t){var r,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S()(t,1),n=r[0],!v()){e.next=3;break}return e.abrupt("return");case 3:if(null==n||!n.isIntersecting){e.next=12;break}return N("entry?.isIntersecting",null==n?void 0:n.isIntersecting),e.prev=5,f(!0),e.next=9,h.current();case 9:return e.prev=9,f(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[5,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[h]);return{loading:d,refCallback:Object(m.useCallback)((function(e){N("ref",e);var r,n=null;if(e&&!n&&window.IntersectionObserver)return N("enter"),n=new IntersectionObserver(y,{threshold:(null==t?void 0:t.threshold)||.1,root:(null===(r=t.root)||void 0===r?void 0:r.current)||null}),N("observe",e),n.observe(e),function(){return n.unobserve(e)}}),[t.threshold])}},A=r(485),O=r(135),x=(r(1031),["className","emptyView","onLoadMore","dataSource","renderItem","loading","showLoadingMore","pagination","children","justify","customItem","loadOnScroll","listContainer"]);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k=v.a.forwardRef((function(e,t){var r=e.className,a=e.emptyView,o=e.onLoadMore,i=e.dataSource,l=e.renderItem,s=e.loading,f=e.showLoadingMore,m=e.pagination,h=e.children,y=e.justify,b=e.customItem,g=e.loadOnScroll,_=e.listContainer,E=d()(e,x),S=e.loadMoreText,C=void 0===S?Object(A.a)("查看更多"):S,N=s;"boolean"==typeof N&&(N={spinning:N});var I=N&&N.spinning,k=j(u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g||!o){e.next=3;break}return e.next=3,o();case 3:case"end":return e.stop()}}),e)}))),{root:_}),R=k.loading,L=k.refCallback;g&&(C=Object(A.a)("到底了"));var P=i.length&&f?v.a.createElement("div",{className:"larkui-list-block-more"},I&&v.a.createElement(O.a,c()({justify:"block"},N)),!I&&v.a.createElement("a",{className:"larkui-list-block-more-btn",ref:L,onClick:function(e){e.preventDefault(),o&&o()}},R?Object(A.a)("加载中"):C)):null;if(I&&!P)return v.a.createElement("div",{className:w()("larkui-list","larkui-list-loading")},v.a.createElement(O.a,c()({justify:"block"},N)));var D=m;return D&&(D=m.total<=m.pageSize?null:T({showSizeChanger:!1},D)),v.a.createElement(n.b,c()({ref:t,className:w()(r,"larkui-list",{"larkui-list-justify-block":"block"===y}),loading:!1,loadMore:P,pagination:D,dataSource:i.length>0?i:e.emptyView?["empty"]:[],renderItem:function(e,t){if("empty"===e)return v.a.createElement("div",{className:"blankslate"},a);var r=l(e,t);return r?b?r:v.a.createElement(n.b.Item,{key:e.id},r):v.a.createElement("div",null)}},E),h)}));k.defaultProps={dataSource:[],loading:!1,showLoadingMore:!1,justify:"flex"},k.propTypes=T(T({},n.b.ListProps),{},{className:y.a.string,emptyView:y.a.node,onLoadMore:y.a.func,dataSource:y.a.array,renderItem:y.a.func,loading:y.a.oneOfType([y.a.bool,y.a.object]),showLoadingMore:y.a.bool,pagination:y.a.object,children:y.a.node,justify:y.a.oneOf(["block","flex"]),customItem:y.a.bool,loadOnScroll:y.a.bool,listContainer:y.a.node}),_()(k,n.b);t.a=k}}]);