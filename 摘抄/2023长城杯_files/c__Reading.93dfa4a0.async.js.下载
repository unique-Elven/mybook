(window.webpackJsonp=window.webpackJsonp||[]).push([[1393],{4228:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(4),i=n.n(a),c=n(55),u=n.n(c),d=n(30),s=n(281);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(null,arguments)}var m=new u.a("doc:error"),p=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(1631)]).then(n.bind(null,2965))}),{suspense:!0}),b=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(1565)]).then(n.bind(null,2963))}),{suspense:!0}),g=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(1535)]).then(n.bind(null,2964))}),{suspense:!0}),h=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(1255),n.e(1522)]).then(n.bind(null,4555))}),{suspense:!0});function f(e){var t=e.error;m("doc load error",t);var n=Object(d.useHistory)();return o.a.createElement("div",{"data-testid":"empty-view"},function(){if(403===t.status){if(null!=t&&t.needVerifyTargetId&&"need_verify_password"===(null==t?void 0:t.code))return o.a.createElement(p,{targetType:"Doc",needVerifyTargetId:t.needVerifyTargetId,onlyContent:!0});var e=t.data,r=e.organization,a=e.canReadOrg,i=e.groupLogin;return(r&&a||!window.appData.isYuque)&&i?o.a.createElement(g,l({},t.data,{history:n,onlyContent:!0})):o.a.createElement(b,l({},t.data,{history:n,onlyContent:!0}))}return[404,500].includes(t.status)?o.a.createElement(h,{status:t.status}):"no_local_cache"===t.message?o.a.createElement(h,{status:911}):o.a.createElement("div",{style:{height:"640px"}})}())}f.propTypes={error:i.a.object.isRequired},t.a=f},4423:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(4),i=n.n(a),c=n(524),u=n(4080);function d(e){var t,n=e.me,a=e.dispatch,i=e.organization,c=null===(t=window.appData.settings)||void 0===t?void 0:t.disabled_login_modal_pop_default;return Object(r.useEffect)((function(){var e,t=i&&i.id,r=null===(e=window.appData.settings)||void 0===e?void 0:e.is_trusted_organization;t&&(i.isPremium||r)&&(c=!0),window.location.pathname.startsWith("/yuque/")&&(c=!0),window.h5&&(c=!0);var o=Object(u.b)("doc_reader_login_modal",864e5);!(null!=n&&n.id||o||c)&&a({type:"error/toggleLoginModal",payload:{visible:!0,from:"doc_reader"}})}),[]),o.a.createElement(o.a.Fragment,null)}d.propTypes={me:i.a.object,dispatch:i.a.func,organization:i.a.object},t.a=Object(c.d)((function(e){return{me:e.me,dispatch:e.dispatch,organization:e.organization}}))(d)},4558:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));n(126);var r=n(38),o=(n(136),n(28)),a=(n(1261),n(1033)),i=n(0),c=n.n(i),u="DocLoading-module_container_nhOpf",d="DocLoading-module_title_ORC1Y",s="DocLoading-module_loading_JiuDc",l="DocLoading-module_col_6Fw0R";function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,d=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){d=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(d)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var b=function(e){var t=e.delayTime,n=void 0===t?100:t,p=e.enableDelay,b=void 0!==p&&p,g=m(Object(i.useState)(!1),2),h=g[0],f=g[1];return Object(i.useEffect)((function(){if(b){var e=setTimeout((function(){f(!0)}),n);return function(){clearTimeout(e)}}}),[]),h||!b?c.a.createElement("div",{className:u,style:e.style},c.a.createElement(a.a,{className:d,title:!0,paragraph:!1,active:!0}),c.a.createElement(r.a,{gutter:16,className:s},c.a.createElement(o.a,{span:24,className:l},c.a.createElement(a.a,{title:!1,paragraph:{rows:3},active:!0})),c.a.createElement(o.a,{span:24,className:l},c.a.createElement(a.a,{title:!1,paragraph:{rows:3},active:!0})))):null}},5048:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(4),i=n.n(a),c=n(524),u=n(30),d=n(981),s=n.n(d),l=n(185),m=n.n(l),p=n(281),b=n(711),g=n(280),h=n(4454),f=n(3843),y=n(33),v=n(2745),R=n(4423),S=n(4228),j=n(4558),O=n(4431),w=n(578),E=Object(p.b)((function(){return n.e(1411).then(n.bind(null,7049))}),{suspense:!0}),k=Object(p.b)((function(){return n.e(1272).then(n.bind(null,7050))}),{suspense:!0}),_=Object(p.b)((function(){return Promise.all([n.e(4),n.e(5),n.e(0),n.e(1),n.e(1423)]).then(n.bind(null,7075))}),{suspense:!0}),C=Object(p.b)((function(){return Promise.all([n.e(1),n.e(13),n.e(1408)]).then(n.bind(null,7076))}),{suspense:!0}),D=Object(p.b)((function(){return Promise.all([n.e(4),n.e(5),n.e(6),n.e(0),n.e(1),n.e(1321)]).then(n.bind(null,7058))}),{suspense:!0});function P(e){var t=e.className,n=void 0===t?"":t,a=e.doc,i=e.group,c=e.book,u=e.isShare,d=e.showHeaderMeta,s=e.review,l=e.shouldRenderPager,m=e.shouldRenderComments,p=e.headingFolding,g=e.currentDocSlug,P=e.currentGroupSlug,q=e.currentBookSlug,M=Object(f.b)().editMode,T=Object(O.b)().sidePanelManager,B=Object(w.b)();Object(r.useEffect)((function(){var e=setTimeout((function(){k.preload(),C.preload()}),5e3);return function(){clearTimeout(e)}}),[]),Object(r.useEffect)((function(){var e=document.querySelector("Link[rel='shortcut icon']");e&&(e.href=function(e,t){var n=b.LOGO_FAVICON.public;if(e.isYuque){var r;n=t?b.EDIT_LOGO_FAVICON.public:(null===(r=e.organization)||void 0===r?void 0:r.logo)||b.LOGO_FAVICON.public}else{var o=t?b.EDIT_LOGO_FAVICON:b.LOGO_FAVICON,a=e.zone;n=o.alibaba,n=0===(null==a?void 0:a.id)?o.alibaba:o.antgroup}return n}(B,M))}),[B,M]);var N=o.a.useCallback((function(){e.dispatch({type:"doc/addCommentCount"})}),[]),G=o.a.useCallback((function(){e.dispatch({type:"doc/reduceCommentCount"})}),[]);return Object(r.useEffect)((function(){if(y.c&&a.loaded&&a.slug===g&&c.slug===q){var e="".concat(P,"/").concat(q);Object(v.a)("save",e,a.slug)}}),[a.loaded,a.slug,g,P,q]),a.loaded||M?a.error?o.a.createElement(S.a,{error:a.error}):g?a.loaded&&a.slug!==g?o.a.createElement("span",{"data-testid":"doc.loaded and doc.slug !== currentDocSlug"}):["Doc","Sheet","Table","Mind","Board","Show"].includes(a.type)?o.a.createElement("div",{className:n},o.a.createElement(R.a,null),"Doc"===a.type&&o.a.createElement(D,{key:"doc-content-".concat(a.id),editMode:M,group:i,book:c,doc:a,review:s,scene:"doc",isShare:u,showHeaderMeta:d,shouldRenderPager:l,shouldRenderComments:m,headingFolding:p,sidePanelManager:T,onCreateComment:N,onRemoveComment:G}),"Sheet"===a.type&&o.a.createElement(C,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,match:e.match,group:i,book:c,doc:a,isShare:u,shouldRenderComments:m}),"Table"===a.type&&o.a.createElement(_,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,match:e.match,group:i,book:c,doc:a,isShare:u,shouldRenderComments:m}),("Mind"===a.type||"Board"===a.type)&&o.a.createElement(k,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,group:i,book:c,doc:a,isShare:u,dispatch:e.dispatch,shouldRenderComments:m}),"Show"===a.type&&o.a.createElement(E,{editMode:M,history:e.history,group:i,book:c,doc:a,isShare:u,dispatch:e.dispatch,shouldRenderComments:m}),o.a.createElement(h.a,{mark:"finish-doc-render"})):o.a.createElement(o.a.Fragment,null,a.content):o.a.createElement("span",{"data-testid":"none-currentDocSlug"}):o.a.createElement(j.a,{enableDelay:!0,delayTime:300})}P.propTypes={className:i.a.string,group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,currentDocSlug:i.a.string.isRequired,currentBookSlug:i.a.string.isRequired,currentGroupSlug:i.a.string.isRequired,review:i.a.object,layout:i.a.oneOf(["center","adapt"]),isShare:i.a.bool,asideWrapperWidth:i.a.number,showHeaderMeta:i.a.bool,shouldRenderPager:i.a.bool,shouldRenderComments:i.a.bool,history:i.a.object,match:i.a.object,dispatch:i.a.func,headingFolding:i.a.bool},t.a=Object(g.b)(Object(u.withRouter)(Object(c.d)((function(e){return{review:e.review}}))(o.a.memo(P,(function(e,t){var n=["className","currentDocSlug","currentBookSlug","currentGroupSlug","book","doc","group","review","editMode","layout","isShare","showHeaderMeta","asideWrapperWidth","shouldRenderPager","shouldRenderComments","scene","headingFolding"];return s()(m.a.apply(void 0,[e].concat(n)),m.a.apply(void 0,[t].concat(n)))})))),!0)},7975:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(4),i=n.n(a),c=n(524),u=n(30),d=n(281),s=n(3843),l=n(55),m=n.n(l),p=n(1254),b=new m.a("doc:share.page.vm");var g=function(e){var t=e.book,n=e.doc,r=e.query,o=e.slug,a=e.appData;return e.dispatch,r=p.a.normalizeReadPageQuery(r),b("process doc: ",o,r),{getQuery:function(){return r},isDocEmbed:function(){return"doc_embed"===r.view},isDocInner:function(){return"Doc"===n.type&&r.inner},isRenderSingleDoc:function(){return t.abilities&&!t.abilities.read},needRenderComments:function(){return n.loaded&&t.enable_comment&&!n.error},needRenderPager:function(){return n.loaded&&!a.isDocCollaborator}}},h=n(6),f=n.n(h),y=n(1030),v=n.n(y),R=n(3658),S=n(5048),j="BookReader-module_wrapper_s6Jdt",O="BookReader-module_editMode_AQq00",w="BookReader-module_docTypographyClassic_tUB5r",E="BookReader-module_content_BGKYX",k="BookReader-module_docContainer_mQ3Tk",_="BookReader-module_sheetContainer_WtnSp";function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function D(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=C(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==C(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){var t=e.group,n=e.book,a=e.doc,i=e.isShare,c=e.showHeaderMeta,u=e.shouldRenderPager,d=void 0===u||u,s=e.scene,l=e.shouldRenderComments,m=e.dispatch,b=e.history,g=e.editMode,h=e.currentDocSlug,y=e.currentBookSlug,C=e.currentGroupSlug,P="classic"===p.a.getTheme(a,n).typography,q={Doc:k,Sheet:_,Mind:_,Show:_,Table:_};return Object(r.useEffect)((function(){var e=v()((function(e){a.loaded&&a.slug!==h||3!==e.eventPhase&&R.c.saveReadPosition(a.id)}),300);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[a,h]),o.a.createElement("div",{className:f()([j],D(D({},w,P),O,g&&"Doc"===a.type)),"data-testid":"content"},o.a.createElement("div",{className:E,id:"main"},o.a.createElement(S.a,{key:a.slug,className:q[a.type],doc:a,group:t,headingFolding:!0,book:n,isShare:i,history:b,scene:s,showHeaderMeta:c,shouldRenderPager:d,shouldRenderComments:l,dispatch:m,currentDocSlug:h,currentBookSlug:y,currentGroupSlug:C})))}P.propTypes={currentDocSlug:i.a.string.isRequired,currentBookSlug:i.a.string.isRequired,currentGroupSlug:i.a.string.isRequired,history:i.a.object.isRequired,group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,editMode:i.a.bool,isShare:i.a.bool,showHeaderMeta:i.a.bool,shouldRenderPager:i.a.bool.isRequired,shouldRenderComments:i.a.bool.isRequired,scene:i.a.oneOf(["doc","other"]),dispatch:i.a.func};var q=o.a.memo(P);function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},M.apply(null,arguments)}var T=Object(d.b)((function(){return n.e(1403).then(n.bind(null,7070))}),{suspense:!0}),B=function(e){var t=e.book,n=e.location,r=e.doc,a=e.match.params,i=window.appData.sharePage,c=i?"doc_slug":"doc",d=Object(s.b)().editMode,l=Object(u.useParams)(),m=l.doc,p=l.group,b=l.book,h=g({book:t,doc:r,query:n.query,slug:a[c],appData:window.appData,dispatch:e.dispatch});return h.isRenderSingleDoc()?o.a.createElement(T,M({currentDocSlug:m,currentBookSlug:b,currentGroupSlug:p,editMode:d,shouldRenderComments:h.needRenderComments(),shouldRenderPager:h.needRenderPager(),isShare:i},e)):o.a.createElement(q,M({},e,{currentDocSlug:m,currentBookSlug:b,currentGroupSlug:p,scene:"doc",editMode:d,shouldRenderComments:h.needRenderComments(),shouldRenderPager:h.needRenderPager(),isShare:i}))};B.propTypes={group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,location:i.a.object,match:i.a.object,history:i.a.object,dispatch:i.a.func};t.default=Object(c.d)((function(e){return{group:e.group,book:e.book,doc:e.doc}}))(Object(u.withRouter)(B))}}]);