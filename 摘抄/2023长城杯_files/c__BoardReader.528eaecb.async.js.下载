(window.webpackJsonp=window.webpackJsonp||[]).push([[1272],{3658:function(e,t,o){"use strict";o.d(t,"a",(function(){return n})),o.d(t,"b",(function(){return r}));var n=".ne-editor-wrap",r=".lake-editor-scroll-container",i=".lake-sheet-scrollbar-x .lake-sheet-scrollbar-trigger",a=".lake-sheet-scrollbar-y .lake-sheet-scrollbar-trigger",s={storePosition:function(e,t){if(sessionStorage){var o=this._getStorageKey(e);sessionStorage.setItem(o,"".concat(t))}},storeSheetPosition:function(e,t){if(sessionStorage){var o=this._getStorageKey(e);sessionStorage.setItem("".concat(o,"-x"),"".concat(t.x)),sessionStorage.setItem("".concat(o,"-y"),"".concat(t.y))}},getStoredPosition:function(e){if(!sessionStorage)return-1;var t=this._getStorageKey(e),o=sessionStorage.getItem(t);return o?parseInt(o,10):-1},getSheetStoredPosition:function(e){if(!sessionStorage)return null;var t=this._getStorageKey(e),o=sessionStorage.getItem("".concat(t,"-x")),n=sessionStorage.getItem("".concat(t,"-y"));return o&&n?{x:parseFloat(o),y:parseFloat(n)}:null},clearStorage:function(e){if(sessionStorage){var t=this._getStorageKey(e);sessionStorage.removeItem(t)}},clearSheetStorage:function(e){if(sessionStorage){var t=this._getStorageKey(e);sessionStorage.removeItem("".concat(t,"-x")),sessionStorage.removeItem("".concat(t,"-y"))}},clearHistoryStorage:function(){sessionStorage&&Object.keys(sessionStorage).forEach((function(e){e.startsWith("content-position-offset-")&&sessionStorage.removeItem(e)}))},_getStorageKey:function(e){return"content-position-offset-".concat(e)}},c={saveReadPosition:function(e){var t,o=(null===(t=document.scrollingElement)||void 0===t?void 0:t.scrollTop)||document.body.scrollTop;o&&o>=32?s.storePosition(e,o):s.clearStorage(e)},letReaderFocusToMemorizedPosition:function(e){var t=s.getStoredPosition(e);t<=0||window.scrollTo(0,t)},letEditorFocusToReadPosition:function(e){var t=s.getStoredPosition(e);if(!(t<=0)){var o=this.getScrollContainer();o&&(o.scrollTop=t)}},getScrollContainer:function(){return document.querySelector(n)||document.querySelector(r)},saveEditPosition:function(e){if("lakesheet"!==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lake")){var t=this.getScrollContainer();if(t){var o=t.scrollTop;o>=32&&s.storePosition(e,o)}}else c.saveSheetPosition(e)},saveSheetPosition:function(e){var t=document.querySelector(i),o=document.querySelector(a);if(t&&o){var n={x:t.getAttribute("data-scroll"),y:o.getAttribute("data-scroll")};s.storeSheetPosition(e,n)}},getSheetStoredPosition:function(e){var t=s.getSheetStoredPosition(e);return t?(s.clearSheetStorage(e),t):null},clearPosition:function(e){e?s.clearStorage(e):s.clearHistoryStorage()}};t.c=c},6861:function(e,t,o){"use strict";t.a={wrapper:"Reader-module_wrapper_8LhoV",adapt:"Reader-module_adapt_jPfiq",content:"Reader-module_content_iqKeO",draft:"Reader-module_draft_zoYcP"}},7050:function(e,t,o){"use strict";o.r(t);var n=o(0),r=o.n(n),i=o(4),a=o.n(i),s=o(55),c=o.n(s),l=o(3658),u=o(281),d=o(274),f=o(6861);function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,i,a,s=[],c=!0,l=!1;try{if(i=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;c=!1}else for(;!(c=(n=i.call(o)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}var S=new c.a("doc:mind.reader"),h=Object(u.b)((function(){return Promise.all([o.e(7),o.e(15),o.e(1243),o.e(1273)]).then(o.bind(null,5034))}),{suspense:!0}),b=Object(u.c)((function(){return Promise.all([o.e(0),o.e(1),o.e(12),o.e(14),o.e(1367)]).then(o.bind(null,4162))}),{suspense:!0}),p=Object(u.c)((function(){return o.e(1267).then(o.bind(null,5088))}),{suspense:!0}),v=Object(u.b)((function(){return Promise.all([o.e(0),o.e(1),o.e(2),o.e(9),o.e(1513)]).then(o.bind(null,2981))}),{suspense:!0});function y(e){var t,o,i=e.doc,a=e.isDocEmbed,s=e.shouldRenderComments,c=e.editMode,l=e.history,u=y.useViewModel({doc:i,isDocEmbed:a,dispatch:e.dispatch}),d=u.getStage();return Object(n.useEffect)((function(){S("mind reader react node created")}),[]),r.a.createElement("div",{className:f.a.wrapper},r.a.createElement("div",{className:f.a.adapt},c?r.a.createElement(v,{history:l,editMode:c}):r.a.createElement(h,{className:f.a.content,content:i.content,width:"100%",height:d.height,onLoad:u.onLoad})),!a&&!c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(b,{type:"Doc",targetId:i.id,likeStatus:null==i||null===(t=i.like)||void 0===t?void 0:t.actioned,likeCount:null==i||null===(o=i.like)||void 0===o?void 0:o.count,size:"bubble",bubblePopover:!0}),r.a.createElement(p,{style:s?{bottom:"32px"}:{bottom:"86px"}})))}y.useViewModel=function(e){var t=e.doc,o=e.isDocEmbed,r=e.dispatch,i=g(Object(n.useState)(document.body.clientHeight),2),a=i[0],s=i[1],c=function(){s(document.body.clientHeight)},u=function(e){l.c.getSheetStoredPosition(t.id)&&console.log("TODO")};return Object(n.useEffect)((function(){return window.addEventListener("resize",c,!1),function(){window.removeEventListener("resize",c,!1)}}),[]),Object(n.useEffect)((function(){v.preload()}),[]),{state:{viewHeight:a},getStage:function(){return{height:a-(o?32:60)}},restorePosition:u,addCommentCount:function(){r({type:"doc/addCommentCount"})},onLoad:function(e){u(),Object(d.a)("docRendered"),b.start(),p.start()},reduceCommentCount:function(){r({type:"doc/reduceCommentCount"})}}},y.propTypes={group:a.a.object.isRequired,book:a.a.object.isRequired,doc:a.a.object.isRequired,isShare:a.a.bool,isDocEmbed:a.a.bool,dispatch:a.a.func,shouldRenderComments:a.a.bool},t.default=y}}]);